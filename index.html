<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gh√©p ·∫£nh c√≥ b·∫£ng x·∫øp h·∫°ng</title>

<style>
body{
  font-family: Arial;
  text-align: center;
  background: #f0f0f0;
}

#timer{
  font-size: 18px;
  margin: 10px;
  font-weight: bold;
}

#game{
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 5px;
  width: 400px;
  margin: auto;
}

.piece{
  aspect-ratio: 1/1;
  background-image: url("anh.jpg");
  background-size: 400px 200px;
  border: 1px solid #333;
  cursor: pointer;
}

#leaderboard{
  margin-top: 15px;
  background: #fff;
  width: 300px;
  margin-left: auto;
  margin-right: auto;
  padding: 10px;
  border-radius: 6px;
}

button{
  margin-top: 10px;
  padding: 6px 12px;
}
</style>
</head>

<body>

<h2>üß© Tr√≤ ch∆°i gh√©p ·∫£nh</h2>
<div id="timer">‚è±Ô∏è Th·ªùi gian: <span id="time">300</span> gi√¢y</div>

<div id="game"></div>

<button onclick="toggleMusic()">üîä B·∫≠t / T·∫Øt nh·∫°c</button>

<div id="leaderboard">
  <h3>üèÜ B·∫£ng x·∫øp h·∫°ng</h3>
  <ol id="scores"></ol>
</div>

<!-- √ÇM THANH -->
<audio id="clickSound" src="click.mp3"></audio>
<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>
<audio id="bgMusic" src="music.mp3" loop></audio>

<script>
const game = document.getElementById("game");
const timeEl = document.getElementById("time");
const scoresEl = document.getElementById("scores");

const clickSound = document.getElementById("clickSound");
const winSound = document.getElementById("winSound");
const loseSound = document.getElementById("loseSound");
const bgMusic = document.getElementById("bgMusic");

let time = 300;
let selected = null;
let musicOn = false;

// b·∫≠t nh·∫°c khi ch·∫°m l·∫ßn ƒë·∫ßu
document.body.addEventListener("click", ()=>{
  if(!musicOn){
    bgMusic.volume = 0.4;
    bgMusic.play();
    musicOn = true;
  }
},{once:true});

// t·∫°o v·ªã tr√≠
let positions = [];
for(let i=0;i<8;i++) positions.push(i);
positions.sort(()=>Math.random()-0.5);

// t·∫°o m·∫£nh
positions.forEach(pos=>{
  const d = document.createElement("div");
  d.className = "piece";

  const x = (pos % 4) * 100;
  const y = Math.floor(pos / 4) * 100;
  d.style.backgroundPosition = `-${x}px -${y}px`;

  d.onclick = ()=>{
    clickSound.currentTime = 0;
    clickSound.play();

    if(!selected){
      selected = d;
      d.style.border = "3px solid red";
    }else{
      swap(selected, d);
      selected.style.border = "1px solid #333";
      selected = null;
      checkWin();
    }
  };

  game.appendChild(d);
});

// ƒë·ªïi ch·ªó
function swap(a,b){
  const temp = a.style.backgroundPosition;
  a.style.backgroundPosition = b.style.backgroundPosition;
  b.style.backgroundPosition = temp;
}

// ki·ªÉm tra th·∫Øng
function checkWin(){
  const pieces = document.querySelectorAll(".piece");
  let ok = true;
  pieces.forEach((p,i)=>{
    const cx = (i % 4) * 100;
    const cy = Math.floor(i / 4) * 100;
    if(p.style.backgroundPosition !== `-${cx}px -${cy}px`) ok=false;
  });

  if(ok){
    bgMusic.pause();
    winSound.play();
    saveScore(time);
    setTimeout(()=>{
      alert("üéâ B·∫°n th·∫Øng! ƒêi·ªÉm: " + time);
      location.reload();
    },300);
  }
}

// l∆∞u ƒëi·ªÉm
function saveScore(score){
  let name = prompt("Nh·∫≠p t√™n c·ªßa b·∫°n:");
  if(!name) name = "·∫®n danh";

  let board = JSON.parse(localStorage.getItem("leaderboard")) || [];
  board.push({name, score});
  board.sort((a,b)=>b.score-a.score);
  board = board.slice(0,5);

  localStorage.setItem("leaderboard", JSON.stringify(board));
  loadScores();
}

// t·∫£i b·∫£ng ƒëi·ªÉm
function loadScores(){
  scoresEl.innerHTML = "";
  let board = JSON.parse(localStorage.getItem("leaderboard")) || [];
  board.forEach(p=>{
    const li = document.createElement("li");
    li.innerText = `${p.name} ‚Äì ${p.score} ƒëi·ªÉm`;
    scoresEl.appendChild(li);
  });
}

// nh·∫°c
function toggleMusic(){
  if(bgMusic.paused) bgMusic.play();
  else bgMusic.pause();
}

// ƒë·∫øm gi·ªù
setInterval(()=>{
  time--;
  timeEl.innerText = time;
  if(time<=0){
    bgMusic.pause();
    loseSound.play();
    setTimeout(()=>{
      alert("‚è∞ H·∫øt gi·ªù!");
      location.reload();
    },300);
  }
},1000);

// load leaderboard khi m·ªü trang
loadScores();
</script>

</body>
</html>
