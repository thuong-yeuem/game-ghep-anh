<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tr√≤ ch∆°i gh√©p ·∫£nh</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f4f4f4;
}

h2 {
  margin-top: 10px;
}

#imageName {
  font-weight: bold;
  margin-bottom: 10px;
}

#timer {
  font-size: 18px;
  margin-bottom: 10px;
}

#game {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  width: 320px;
  margin: 10px auto;
  gap: 0;
}

.piece {
  width: 80px;
  height: 80px;
  background-size: 320px 160px;
}

button {
  padding: 8px 12px;
  margin: 5px;
  font-size: 14px;
  cursor: pointer;
}

#leaderboard {
  display: none;
  background: white;
  width: 300px;
  margin: 10px auto;
  padding: 10px;
  border-radius: 8px;
}
</style>
</head>

<body>

<h2>üß© Tr√≤ ch∆°i gh√©p ·∫£nh</h2>
<p id="imageName">üì∑ T√™n ·∫£nh: H·ªôi ngh·ªã qu·ªëc t·∫ø</p>
<div id="timer">‚è± Th·ªùi gian: 300 gi√¢y</div>

<div id="game"></div>

<button onclick="toggleMusic()">üîä B·∫≠t / T·∫Øt nh·∫°c</button>
<button onclick="showLeaderboard()">üèÜ B·∫£ng x·∫øp h·∫°ng</button>

<div id="leaderboard">
  <h3>üèÜ B·∫£ng x·∫øp h·∫°ng</h3>
  <ol id="rankList"></ol>
  <button onclick="closeLeaderboard()">ƒê√≥ng</button>
</div>

<!-- √ÇM THANH -->
<audio id="clickSound" src="click.mp3"></audio>
<audio id="bgMusic" src="music.mp3" loop></audio>

<script>
/* ===== C·∫§U H√åNH ===== */
const img = "anh.jpg";       // t√™n ·∫£nh
const imageTitle = "H·ªôi ngh·ªã qu·ªëc t·∫ø";
const rows = 2;
const cols = 4;
let time = 300;

/* ===== HI·ªÇN TH·ªä T√äN ·∫¢NH ===== */
document.getElementById("imageName").innerText =
  "üì∑ T√™n ·∫£nh: " + imageTitle;

/* ===== GAME ===== */
const game = document.getElementById("game");
let pieces = [];
let first = null;

/* T·∫†O M·∫¢NH */
for (let i = 0; i < rows * cols; i++) {
  pieces.push(i);
}
pieces.sort(() => Math.random() - 0.5);

pieces.forEach(p => {
  const d = document.createElement("div");
  d.className = "piece";
  d.dataset.pos = p;
  d.style.backgroundImage = `url(${img})`;
  d.style.backgroundPosition =
    `-${(p % cols) * 80}px -${Math.floor(p / cols) * 80}px`;
  d.onclick = () => clickPiece(d);
  game.appendChild(d);
});

/* CLICK */
function clickPiece(el) {
  document.getElementById("clickSound").play();
  if (!first) {
    first = el;
    el.style.opacity = 0.5;
  } else {
    swap(first, el);
    first.style.opacity = 1;
    first = null;
    checkWin();
  }
}

/* ƒê·ªîI CH·ªñ */
function swap(a, b) {
  const temp = a.style.backgroundPosition;
  a.style.backgroundPosition = b.style.backgroundPosition;
  b.style.backgroundPosition = temp;

  const t = a.dataset.pos;
  a.dataset.pos = b.dataset.pos;
  b.dataset.pos = t;
}

/* KI·ªÇM TRA TH·∫ÆNG */
function checkWin() {
  const all = document.querySelectorAll(".piece");
  for (let i = 0; i < all.length; i++) {
    if (all[i].dataset.pos != i) return;
  }
  saveScore();
  alert("üéâ B·∫°n ƒë√£ th·∫Øng!");
}

/* ===== TIMER ===== */
setInterval(() => {
  time--;
  document.getElementById("timer").innerText =
    "‚è± Th·ªùi gian: " + time + " gi√¢y";
  if (time <= 0) {
    alert("‚è∞ H·∫øt gi·ªù!");
    location.reload();
  }
}, 1000);

/* ===== NH·∫†C ===== */
let musicOn = false;
function toggleMusic() {
  const m = document.getElementById("bgMusic");
  if (musicOn) m.pause();
  else m.play();
  musicOn = !musicOn;
}

/* ===== B·∫¢NG X·∫æP H·∫†NG ===== */
function saveScore() {
  const name = prompt("Nh·∫≠p t√™n c·ªßa b·∫°n:");
  if (!name) return;

  const score = 300 - time;
  const list = JSON.parse(localStorage.getItem("rank") || "[]");
  list.push({ name, score });
  list.sort((a, b) => a.score - b.score);
  localStorage.setItem("rank", JSON.stringify(list));
}

function showLeaderboard() {
  const list = JSON.parse(localStorage.getItem("rank") || "[]");
  const ol = document.getElementById("rankList");
  ol.innerHTML = "";
  list.forEach(i => {
    const li = document.createElement("li");
    li.innerText = `${i.name} - ${i.score}s`;
    ol.appendChild(li);
  });
  document.getElementById("leaderboard").style.display = "block";
}

function closeLeaderboard() {
  document.getElementById("leaderboard").style.display = "none";
}
</script>

</body>
</html>
